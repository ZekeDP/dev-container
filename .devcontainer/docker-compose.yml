version: "3.9"

services:
  backend-dev:
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
      args:
        PROJECT_HOME: ${PROJECT_HOME:-/car-rental}
    container_name: java-backend-dev-ubuntu
    command: sleep infinity

    volumes:
      # Mount entire project directory
      - ..:${PROJECT_HOME:-/car-rental}:cached

      # Cache Gradle and Maven dependencies
      - gradle-cache:/home/vscode/.gradle
      - maven-cache:/home/vscode/.m2

      # Mount SSH directory for git operations
      - type: bind
        source: ${HOME}/.ssh
        target: /tmp/host-ssh
        read_only: true

    env_file:
      - ../config/.env

    # environment:
      # Application ports
      # - BACKEND_PORT=8080
      # - FRONTEND_PORT=5173
    
    networks:
      - devnet
    
    # Port mappings
    ports:
      - "8080:8080"
      - "5173:5173"

networks:
  devnet:
    name: car-rental-devnet
    driver: bridge

volumes:
  gradle-cache:
    name: gradle-cache-ubuntu
  maven-cache:
    name: maven-cache-ubuntu